<!DOCTYPE html>
<html lang="id">
<head>
    <title>CRUD App</title>
    <link rel="stylesheet" href="style.css">
    <script>
        if (!sessionStorage.getItem("user")) {
            window.location.href = "login.html";
        }
    </script>
</head>
<body>
    <h2>CRUD App</h2>
    <button onclick="logout()">Logout</button>
    <button onclick="showForm()">Tambah Data</button>

    <div id="form">
        <input type="hidden" id="itemId">
        <input type="text" id="itemName" placeholder="Nama">
        <textarea id="itemDesc" placeholder="Deskripsi"></textarea>
        <button onclick="saveData()">Simpan</button>
    </div>

    <table>
        <thead>
            <tr><th>ID</th><th>Nama</th><th>Aksi</th></tr>
        </thead>
        <tbody id="data-list"></tbody>
    </table>

    <script>
        function loadData() {
            fetch("../server/crud.php?action=get")
            .then(res => res.json())
            .then(data => {
                document.getElementById("data-list").innerHTML = data.map(d => 
                    `<tr>
                        <td>${d.id}</td>
                        <td>${d.name}</td>
                        <td>
                            <button onclick="editData(${d.id}, '${d.name}', '${d.description}')">Edit</button>
                            <button onclick="deleteData(${d.id})">Hapus</button>
                        </td>
                    </tr>`
                ).join("");
            });
        }

        function saveData() {
            let id = document.getElementById("itemId").value;
            let name = document.getElementById("itemName").value;
            let desc = document.getElementById("itemDesc").value;

            fetch(`../server/crud.php?action=${id ? "update" : "add"}`, {
                method: "POST",
                body: new URLSearchParams({ id, name, description: desc })
            }).then(() => loadData());
        }

        function deleteData(id) {
            fetch("../server/crud.php?action=delete", {
                method: "POST",
                body: new URLSearchParams({ id })
            }).then(() => loadData());
        }

        function logout() {
            sessionStorage.removeItem("user");
            window.location.href = "login.html";
        }

        loadData();
    </script>
</body>
</html>
